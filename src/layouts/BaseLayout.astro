---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { ViewTransitions } from 'astro:transitions';
import '../styles/global.css';

export interface Props {
  title: string;
  description: string;
  ogImage?: string;
}

const { title, description, ogImage } = Astro.props;
const pageUrl = Astro.url.href;
const imageUrl = new URL(ogImage || '/ogp-default.png', Astro.url).href;
---
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <title>{title}</title>
  <meta name="description" content={description} />
  {/* OGP Tags */}
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:type" content="website" />
  <meta property="og:url" content={pageUrl} />
  <meta property="og:image" content={imageUrl} />
  <meta property="og:site_name" content="My Portfolio" />
  <meta name="twitter:card" content="summary_large_image" />
  <ViewTransitions />
</head>
<body class="bg-white text-gray-900 font-sans">

  <div id="top"></div>
  
  <div id="age-gate" class="fixed inset-0 bg-white/80 backdrop-blur-md z-[9999] flex items-center justify-center">
    <div class="bg-white p-8 rounded-lg shadow-2xl text-center max-w-sm mx-4">
      <h2 class="text-xl font-bold mb-4">年齢確認</h2>
      <p class="text-gray-600 mb-6">このウェブサイトには18歳以上を対象としたコンテンツが含まれています。18歳未満の方はご遠慮ください。</p>
      <div class="flex justify-center gap-4">
        <button id="age-gate-yes" class="bg-gray-800 text-white font-bold py-2 px-8 rounded-lg hover:bg-gray-700 transition-colors">はい</button>
        <button id="age-gate-no" class="bg-gray-200 text-gray-700 font-bold py-2 px-8 rounded-lg hover:bg-gray-300 transition-colors">いいえ</button>
      </div>
    </div>
  </div>

  <script is:inline>
    if (sessionStorage.getItem('isVerified') === 'true') {
      document.getElementById('age-gate').style.display = 'none';
    }
  </script>

  <div id="cursor-outline"></div>
  <Header />

  <main class="max-w-7xl mx-auto p-6">
    <slot />
  </main>
  <Footer />

  <script>
    document.addEventListener('astro:page-load', () => {
      // === 年齢確認ゲートのコード ===
      const ageGate = document.querySelector<HTMLElement>('#age-gate');
      const ageGateYes = document.querySelector<HTMLElement>('#age-gate-yes');
      const ageGateNo = document.querySelector<HTMLElement>('#age-gate-no');

      if (ageGate && ageGateYes && ageGateNo) {
        if (sessionStorage.getItem('isVerified') === 'true') {
          ageGate.style.display = 'none';
        } 
        // この行を削除:
    // else {
    //   ageGate.style.display = 'flex'; // もしまだなら表示
    // }

        if (!ageGate.dataset.listenerAttached) {
          ageGateYes.addEventListener('click', () => {
            ageGate.style.display = 'none';
            sessionStorage.setItem('isVerified', 'true');
          });
          ageGateNo.addEventListener('click', () => { window.location.href = 'about:blank'; });
          ageGate.dataset.listenerAttached = 'true';
        }
      }

      // === スクロールアニメーションのコード ===
      const fadeInTargets = document.querySelectorAll('.fade-in-on-scroll');
      const fadeInObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            fadeInObserver.unobserve(entry.target);
          }
        });
      });
      fadeInTargets.forEach(target => {
        fadeInObserver.observe(target);
      });

      // === カスタムカーソルのコード ===
      const cursorOutline = document.querySelector<HTMLElement>('#cursor-outline');
      if (cursorOutline) {
        window.addEventListener('mousemove', (e) => {
          const posX = e.clientX;
          const posY = e.clientY;
          requestAnimationFrame(() => {
            cursorOutline.style.left = `${posX}px`;
            cursorOutline.style.top = `${posY}px`;
          });
        });
        const hoverableElements = document.querySelectorAll('a, button');
        hoverableElements.forEach(el => {
          el.addEventListener('mouseenter', () => { cursorOutline.classList.add('is-hovered'); });
          el.addEventListener('mouseleave', () => { cursorOutline.classList.remove('is-hovered'); });
        });
      }
    });
  </script>
</body>
</html>